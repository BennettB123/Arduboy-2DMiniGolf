#pragma once

#include "FX/ArduboyFX.h"
#include <Arduboy2.h>

constexpr uint8_t CreditsSpriteWidth = 80;
constexpr uint8_t CreditsSpriteHeight = 19;

constexpr uint8_t CreditsSprite[] PROGMEM{
    // Frame 0
    0x7F, 0xFF, 0xC3, 0xDB, 0xFB, 0xFA, 0x00, 0xFE, 0xFF, 0x37, 0x33, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0x0C, 0x0C, 0xFF, 0xFF, 0x00, 0x7F, 0xFF, 0xDB, 0xDB, 0xDB, 0xDB, 0x00, 0xDE, 0xDF, 0xDB, 0xDB, 0xFB, 0x7B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xCB, 0xDB, 0xFF, 0x76, 0x00, 0x0F, 0x1F, 0xF8, 0xF8, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x0C, 0x02, 0x01, 0x49, 0xD9, 0xC1, 0xC9, 0x59, 0x01, 0x02, 0x0C, 0xF0, 0x00, 0x00, 0x00, 0x00,
    0xF8, 0xF8, 0x58, 0xD8, 0xF8, 0xB0, 0x00, 0xF8, 0xF8, 0xD8, 0xD8, 0xD8, 0xD8, 0x00, 0xF0, 0xF8, 0x18, 0x18, 0xF8, 0xF8, 0x00, 0xF8, 0xF8, 0x18, 0xD8, 0xD8, 0xD0, 0x00, 0xF8, 0xF8, 0x00, 0x00, 0xF8, 0xF8, 0x00, 0x18, 0x18, 0xF8, 0xF8, 0x18, 0x18, 0x00, 0xF0, 0xF8, 0x18, 0x18, 0xF8, 0xF8, 0x00, 0x18, 0x18, 0xF8, 0xF8, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x42, 0x21, 0x38, 0x40, 0x9C, 0xBE, 0x3E, 0xBC, 0xBD, 0xBC, 0x3E, 0xBE, 0x9C, 0x40, 0x38, 0x21, 0x42, 0x7C, 0x00,
    0x07, 0x07, 0x06, 0x06, 0x07, 0x03, 0x00, 0x03, 0x07, 0x06, 0x06, 0x06, 0x06, 0x00, 0x07, 0x07, 0x00, 0x00, 0x07, 0x07, 0x00, 0x03, 0x07, 0x06, 0x06, 0x07, 0x07, 0x00, 0x03, 0x07, 0x06, 0x06, 0x07, 0x07, 0x00, 0x06, 0x06, 0x07, 0x07, 0x06, 0x06, 0x00, 0x07, 0x07, 0x00, 0x00, 0x07, 0x07, 0x00, 0x06, 0x06, 0x07, 0x07, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x06, 0x05, 0x04, 0x07, 0x00, 0x07, 0x04, 0x05, 0x06, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00};

void PlayCreditsAnimation(Arduboy2Base arduboy)
{
    int16_t x = -CreditsSpriteWidth;
    int16_t y = 24;

    auto displayCreditsSprite = [&]()
    {
        while (!arduboy.nextFrame());

        arduboy.pollButtons();
        arduboy.clear();
        arduboy.drawBitmap(x, y, CreditsSprite, CreditsSpriteWidth, CreditsSpriteHeight);
        FX::display();
    };

    // move right to center of screen
    while (x < 22)
    {
        if (arduboy.justPressed(A_BUTTON) | arduboy.justPressed(B_BUTTON))
            return;
            
        displayCreditsSprite();
        x += 4;
    }

    // hold for a few frames
    for (uint8_t i = 0; i < 80; i++){
        if (arduboy.justPressed(A_BUTTON) || arduboy.justPressed(B_BUTTON))
            return;

        displayCreditsSprite();
    }

    // move off screen
    while (x < WIDTH + 60)
    {
        if (arduboy.justPressed(A_BUTTON) | arduboy.justPressed(B_BUTTON))
            return;
            
        displayCreditsSprite();
        x += 4;
    }
}